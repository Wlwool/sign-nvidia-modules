# NVIDIA Secure Boot auto-sign bash script (Ubuntu)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –º–æ–¥—É–ª–µ–π NVIDIA –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ **Secure Boot** –≤ Ubuntu. –ò–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –º–æ–¥—É–ª–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —è–¥—Ä–∞ –∏–ª–∏ –¥—Ä–∞–π–≤–µ—Ä–∞.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Secure Boot**: –≤–∫–ª—é—á—ë–Ω –≤ BIOS/UEFI
- **MOK-–∫–ª—é—á**: —Å–æ–∑–¥–∞–Ω –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ
- **–ü—É—Ç–∏ –∫–ª—é—á–µ–π**:
  ```
  /root/secure-mok/MOK.priv
  /root/secure-mok/MOK.der
  ```
- **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã**:
  ```bash
  sudo apt install dkms linux-headers-$(uname -r)
  ```

## üîë –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–º–ø–æ—Ä—Ç –∫–ª—é—á–∞ MOK

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π

```bash
# –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∫–ª—é—á–µ–π
sudo mkdir -p /root/secure-mok
cd /root/secure-mok

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä—É –∫–ª—é—á–µ–π RSA (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 100 –ª–µ—Ç)
sudo openssl req -new -x509 -newkey rsa:2048 -keyout MOK.priv -out MOK.der \
  -nodes -days 36500 -subj "/CN=MyNvidiaKey/"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
sudo chmod 600 MOK.priv
sudo chmod 644 MOK.der
```

### –®–∞–≥ 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –≤ —Å–∏—Å—Ç–µ–º–µ

```bash
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª—é—á –≤ MOK (Machine Owner Key)
sudo mokutil --import /root/secure-mok/MOK.der
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞—â–∏—Ç—ã –∫–ª—é—á–∞.

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ—Å—å: `sudo reboot`
2. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ—è–≤–∏—Ç—Å—è —ç–∫—Ä–∞–Ω **MOK Manager** (—Å–∏–Ω–∏–π —ç–∫—Ä–∞–Ω —Å –º–µ–Ω—é)
3. –í—ã–±–µ—Ä–∏—Ç–µ **Enroll MOK** ‚Üí **Continue** ‚Üí **Yes**
4. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞ –®–∞–≥–µ 2
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ: **Reboot**

–°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∫–ª—é—á –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –∞–≤—Ç–æ–ø–æ–¥–ø–∏—Å–∏

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –ø–æ–¥–ø–∏—Å–∏

```bash
sudo nano /usr/local/bin/sign-nvidia-modules.sh
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞**:

```bash
#!/bin/bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å—å –º–æ–¥—É–ª–µ–π NVIDIA –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º Secure Boot
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —è–¥—Ä–∞ –∏–ª–∏ –¥—Ä–∞–π–≤–µ—Ä–∞

MOK_PRIV="/root/secure-mok/MOK.priv"
MOK_DER="/root/secure-mok/MOK.der"
SIGN_TOOL="/usr/src/linux-headers-$(uname -r)/scripts/sign-file"
MODULES=(nvidia nvidia_drm nvidia_modeset nvidia_uvm)

echo "–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π NVIDIA..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å—Ç—å –ª–∏ –∫–ª—é—á–∏
if [[ ! -f "$MOK_PRIV" ]] || [[ ! -f "$MOK_DER" ]]; then
    echo "‚ùå –û—à–∏–±–∫–∞: MOK-–∫–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ $MOK_PRIV –∏ $MOK_DER"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
if [[ ! -f "$SIGN_TOOL" ]]; then
    echo "‚ùå –û—à–∏–±–∫–∞: sign-file –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ linux-headers-$(uname -r)"
    exit 1
fi

# –ü–æ–¥–ø–∏—Å—ã–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
for mod in "${MODULES[@]}"; do
    MODPATH=$(modinfo -n "$mod" 2>/dev/null)
    
    if [[ -f "$MODPATH" ]]; then
        echo "–ü–æ–¥–ø–∏—Å—ã–≤–∞–Ω–∏–µ $mod -> $MODPATH"
        sudo "$SIGN_TOOL" sha256 "$MOK_PRIV" "$MOK_DER" "$MODPATH"
        
        if [[ $? -eq 0 ]]; then
            echo "$mod –ø–æ–¥–ø–∏—Å–∞–Ω —É—Å–ø–µ—à–Ω–æ"
        else
            echo "‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–ø–∏—Å–∞—Ç—å $mod"
        fi
    else
        echo "–ú–æ–¥—É–ª—å $mod –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞—é"
    fi
done

# –û–±–Ω–æ–≤–ª—è–µ–º initramfs –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
echo "–û–±–Ω–æ–≤–ª—è—é initramfs..."
sudo update-initramfs -u -k all

echo "–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à—ë–Ω!"
```

### –®–∞–≥ 2: –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º

```bash
sudo chmod +x /usr/local/bin/sign-nvidia-modules.sh
```

## üîÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (DKMS Hook)

–≠—Ç–æ—Ç —à–∞–≥ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ DKMS.

### –°–æ–∑–¥–∞–Ω–∏–µ post-build hook

```bash
# –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è hooks
sudo mkdir -p /etc/dkms/post-build.d

# –°–æ–∑–¥–∞—ë–º hook-—Å–∫—Ä–∏–ø—Ç
sudo nano /etc/dkms/post-build.d/sign-nvidia
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ hook**:

```bash
#!/bin/bash
# DKMS post-build hook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–ø–∏—Å–∏ NVIDIA –º–æ–¥—É–ª–µ–π
/usr/local/bin/sign-nvidia-modules.sh
```

### –î–µ–ª–∞–µ–º hook –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º

```bash
sudo chmod +x /etc/dkms/post-build.d/sign-nvidia
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π –º–æ–¥—É–ª–µ–π

```bash
# –í—ã–≤–µ–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å–∏ –º–æ–¥—É–ª—è nvidia
modinfo -F signer $(modinfo -n nvidia)
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –¥–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –∏–º—è –≤–∞—à–µ–≥–æ –∫–ª—é—á–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `MyNvidiaKey`). –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç –∏–ª–∏ –≤—ã–≤–æ–¥–∏—Ç –æ—à–∏–±–∫—É, —Ç–æ –º–æ–¥—É–ª—å –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Secure Boot

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∫–ª—é—á—ë–Ω –ª–∏ Secure Boot
mokutil --sb-state
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏

```bash
# –ò—â–µ—Ç –æ—à–∏–±–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π
sudo dmesg | grep -i 'module verification'
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è

```bash
sudo /usr/local/bin/sign-nvidia-modules.sh
```

## üß∞ –û—Ç–ª–∞–¥–∫–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥—É–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö —è–¥—Ä–∞
sudo dmesg | tail -20
sudo dmesg | grep -i nvidia

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –º–æ–¥—É–ª—è
lsmod | grep nvidia

# –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å –≤—Ä—É—á–Ω—É—é
sudo modprobe nvidia
```

### –ü—Ä–æ–±–ª–µ–º–∞: "sign-file not found"

```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º headers –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —è–¥—Ä–∞
sudo apt install --reinstall linux-headers-$(uname -r)
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–ª—é—á –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ MOK-–∫–ª—é—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ
sudo mokutil --list-enrolled

# –ï—Å–ª–∏ –∫–ª—é—á–µ–π –Ω–µ—Ç, –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º
sudo mokutil --import /root/secure-mok/MOK.der
sudo reboot
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–æ–ª—å

–ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –≤–≤–æ–¥–µ `sudo`, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
sudo -s  # –í–æ–π–¥–∏—Ç–µ –≤ sudo-—Å–µ—Å—Å–∏—é
/usr/local/bin/sign-nvidia-modules.sh
exit
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á**: `MOK.priv` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—â–∏—â—ë–Ω —Å –ø—Ä–∞–≤–∞–º–∏ `600` –∏ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ `/root/secure-mok`
- **–ù–µ –∫–æ–ø–∏—Ä—É–π—Ç–µ**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–ø–∏—Ä—É–π—Ç–µ `MOK.priv` –≤ –¥–æ–º–∞—à–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è**: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `MOK.priv` –∏ `MOK.der` –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ –º–µ—Å—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π USB)
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å NVIDIA-–¥—Ä–∞–π–≤–µ—Ä–∞–º–∏, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Ubuntu –∏–ª–∏ —á–µ—Ä–µ–∑ DKMS

## üìå –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥—É–ª–µ
modinfo nvidia

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥—Ä–∞–π–≤–µ—Ä–∞
nvidia-smi

# –°—Ç–∞—Ç—É—Å MOK-–∫–ª—é—á–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ
sudo mokutil --list-enrolled

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ DKMS
sudo dkms status

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞ NVIDIA —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π –º–æ–¥—É–ª–µ–π
sudo apt install --reinstall nvidia-driver-XXX
```

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [NVIDIA —Å Secure Boot –Ω–∞ Ubuntu - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥](https://dev.to/gordinmitya/nvidia-drivers-with-secure-boot-on-ubuntu-59h4)
- [Debian Wiki: Secure Boot](https://wiki.debian.org/SecureBoot)
- [NVIDIA Developer Forums](https://forums.developer.nvidia.com)

---
 
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: Ubuntu 22.04 LTS, Ubuntu 24.04 LTS, Ubuntu 24.10+  
**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞**: NVIDIA Driver 560+
